{% extends "base.html" %}

{% block title %}
  {% if mode == 'new' %}
    {{ _('printer_form_new_title') }} – PrintFleet
  {% else %}
    {{ _('printer_form_edit_title') }} – PrintFleet
  {% endif %}
{% endblock %}

{% block content %}
<h2>
  {% if mode == 'new' %}
    {{ _('printer_form_new_title') }}
  {% else %}
    {{ _('printer_form_edit_title') }}: {{ printer["name"] }}
  {% endif %}
</h2>

{% if error %}
  <p style="color:red;">{{ error }}</p>
{% endif %}

<form method="post">
    <div>
        <label for="name">{{ _('printer_form_name_label') }}*</label><br>
        <input type="text" id="name" name="name"
               value="{% if printer %}{{ printer['name'] }}{% endif %}" required>
    </div>

    <div>
        <label for="backend">{{ _('printer_form_backend_label') }}*</label><br>
        <select id="backend" name="backend" required>
            {% set current_backend = printer['backend'] if printer else 'moonraker' %}
            <option value="moonraker" {% if current_backend == 'moonraker' %}selected{% endif %}>Moonraker</option>
            <option value="octoprint" {% if current_backend == 'octoprint' %}selected{% endif %}>OctoPrint</option>
        </select>
    </div>

    <div>
        <label for="host">{{ _('printer_form_host_label') }}*</label><br>
        <input type="text" id="host" name="host"
               value="{% if printer %}{{ printer['host'] }}{% endif %}" required>
    </div>

    <div>
        <label for="port">{{ _('printer_form_port_label') }}*</label><br>
        <input type="number" id="port" name="port"
               value="{% if printer %}{{ printer['port'] }}{% else %}80{% endif %}" required>
    </div>

    <div>
        <label>
            <input type="checkbox" name="https"
                   {% if printer and printer['https'] %}checked{% endif %}>
            {{ _('printer_form_https_label') }}
        </label>
    </div>

    <div>
        <label for="token">{{ _('printer_form_token_label') }}</label><br>
        <input type="text" id="token" name="token"
               value="{% if printer %}{{ printer['token'] or '' }}{% endif %}">
    </div>

    <div>
        <label for="api_key">{{ _('printer_form_api_key_label') }}</label><br>
        <input type="text" id="api_key" name="api_key"
               value="{% if printer %}{{ printer['api_key'] or '' }}{% endif %}">
    </div>

    <!-- NEU: Tasmota-IP-Adresse -->
    <div>
        <label for="tasmota_host">{{ _('printer_form_tasmota_host_label') }}</label><br>
        <input type="text" id="tasmota_host" name="tasmota_host"
               placeholder="192.168.1.20"
               value="{% if printer %}{{ printer['tasmota_host'] or '' }}{% endif %}">
    </div>

    <div>
        <label for="error_report_interval">{{ _('printer_form_error_interval_label') }}</label><br>
        <input type="number" step="1" min="1" id="error_report_interval" name="error_report_interval"
               value="{% if printer %}{{ printer['error_report_interval'] }}{% else %}30{% endif %}">
    </div>

    {% if mode == 'edit' %}
    <div>
        <label>
            <input type="checkbox" name="enabled"
                   {% if printer and printer['enabled'] %}checked{% endif %}>
            {{ _('printer_form_enabled_label') }}
        </label>
    </div>
    {% endif %}

    <p>
        <button type="submit" class="btn">
          {% if mode == 'new' %}
            {{ _('printer_form_create_button') }}
          {% else %}
            {{ _('printer_form_save_button') }}
          {% endif %}
        </button>
        <a href="{{ url_for('printer_list') }}" class="btn">{{ _('printer_form_back_to_list') }}</a>
    </p>
</form>

{% if mode == 'edit' %}
<hr>
<h3>{{ _('printer_form_delete_title') }}</h3>
<form method="post" action="{{ url_for('printer_delete', printer_id=printer['id']) }}"
      onsubmit="return confirm('{{ _('printer_form_delete_confirm') }}');">
    <button type="submit" class="btn" style="background:#b91c1c;">
        {{ _('printer_form_delete_button') }}
    </button>
</form>
{% endif %}

{% endblock %}