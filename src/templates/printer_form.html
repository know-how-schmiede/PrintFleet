{% extends "base.html" %}

{% block title %}
  {% if mode == 'new' %}Neuer Drucker – PrintFleet{% else %}Drucker bearbeiten – PrintFleet{% endif %}
{% endblock %}

{% block content %}
<h2>
  {% if mode == 'new' %}
    Neuer Drucker
  {% else %}
    Drucker bearbeiten: {{ printer["name"] }}
  {% endif %}
</h2>

{% if error %}
  <p style="color:red;">{{ error }}</p>
{% endif %}

<form method="post">
    <div>
        <label for="name">Name*</label><br>
        <input type="text" id="name" name="name"
               value="{% if printer %}{{ printer['name'] }}{% endif %}" required>
    </div>

    <div>
        <label for="backend">Backend*</label><br>
        <select id="backend" name="backend" required>
            {% set current_backend = printer['backend'] if printer else 'moonraker' %}
            <option value="moonraker" {% if current_backend == 'moonraker' %}selected{% endif %}>Moonraker</option>
            <option value="octoprint" {% if current_backend == 'octoprint' %}selected{% endif %}>OctoPrint</option>
        </select>
    </div>

    <div>
        <label for="host">Host*</label><br>
        <input type="text" id="host" name="host"
               value="{% if printer %}{{ printer['host'] }}{% endif %}" required>
    </div>

    <div>
        <label for="port">Port*</label><br>
        <input type="number" id="port" name="port"
               value="{% if printer %}{{ printer['port'] }}{% else %}80{% endif %}" required>
    </div>

    <div>
        <label>
            <input type="checkbox" name="https"
                   {% if printer and printer['https'] %}checked{% endif %}>
            HTTPS verwenden
        </label>
    </div>

    <div>
        <label for="token">Token (Moonraker)</label><br>
        <input type="text" id="token" name="token"
               value="{% if printer %}{{ printer['token'] or '' }}{% endif %}">
    </div>

    <div>
        <label for="api_key">API-Key (OctoPrint)</label><br>
        <input type="text" id="api_key" name="api_key"
               value="{% if printer %}{{ printer['api_key'] or '' }}{% endif %}">
    </div>

    <div>
        <label for="error_report_interval">Fehlermeldungs-Intervall (Sek.)</label><br>
        <input type="number" step="1" min="1" id="error_report_interval" name="error_report_interval"
               value="{% if printer %}{{ printer['error_report_interval'] }}{% else %}30{% endif %}">
    </div>

    {% if mode == 'edit' %}
    <div>
        <label>
            <input type="checkbox" name="enabled"
                   {% if printer and printer['enabled'] %}checked{% endif %}>
            Drucker aktiviert
        </label>
    </div>
    {% endif %}

    <p>
        <button type="submit" class="btn">
          {% if mode == 'new' %}Anlegen{% else %}Speichern{% endif %}
        </button>
        <a href="{{ url_for('printer_list') }}" class="btn">Zurück zur Liste</a>
    </p>
</form>

{% if mode == 'edit' %}
<hr>
<h3>Drucker löschen</h3>
<form method="post" action="{{ url_for('printer_delete', printer_id=printer['id']) }}"
      onsubmit="return confirm('Diesen Drucker wirklich löschen?');">
    <button type="submit" class="btn" style="background:#b91c1c;">
        Löschen
    </button>
</form>
{% endif %}

{% endblock %}